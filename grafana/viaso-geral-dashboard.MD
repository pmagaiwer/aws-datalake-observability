# ğŸ§­ VisÃ£o Geral do Dashboard

**Nome:** ğŸ§© Data Lake Reliability â€“ AWS Glue & EMR  
**Objetivo:** Monitorar a confiabilidade, performance e custo das cargas de dados do Data Lake AWS.

---

## ğŸ“ PainÃ©is principais

- âœ… VisÃ£o geral de confiabilidade (SLI/SLO geral)  
- ğŸ§© AWS Glue â€“ sucesso e duraÃ§Ã£o dos jobs  
- âš™ï¸ AWS EMR â€“ performance e utilizaÃ§Ã£o  
- ğŸš¨ Alertas e erros crÃ­ticos  

---

## ğŸ§± 1ï¸âƒ£ Estrutura do Dashboard (visÃ£o hierÃ¡rquica)

ğŸ“Š Data Lake Reliability Dashboard
â”œâ”€â”€ 1ï¸âƒ£ Overview
â”‚ â”œâ”€â”€ SLI: % de jobs Glue concluÃ­dos
â”‚ â”œâ”€â”€ SLI: Tempo mÃ©dio de execuÃ§Ã£o Glue
â”‚ â”œâ”€â”€ SLI: Tempo mÃ©dio dos jobs EMR
â”‚ â””â”€â”€ SLO: 99% jobs Glue e EMR completando < 15min
â”œâ”€â”€ 2ï¸âƒ£ AWS Glue
â”‚ â”œâ”€â”€ Painel: Taxa de sucesso dos jobs ETL
â”‚ â”œâ”€â”€ Painel: DuraÃ§Ã£o mÃ©dia dos jobs (P95)
â”‚ â”œâ”€â”€ Painel: Falhas por job
â”‚ â””â”€â”€ Painel: Tempo de fila/execuÃ§Ã£o (start delay)
â”œâ”€â”€ 3ï¸âƒ£ AWS EMR
â”‚ â”œâ”€â”€ Painel: DuraÃ§Ã£o mÃ©dia de jobs Spark
â”‚ â”œâ”€â”€ Painel: Falhas por job e tipo
â”‚ â”œâ”€â”€ Painel: Uso de CPU e memÃ³ria por cluster
â”‚ â”œâ”€â”€ Painel: Tempo mÃ©dio de provisionamento
â”‚ â””â”€â”€ Painel: Custo estimado (EC2 + EMR)
â””â”€â”€ 4ï¸âƒ£ Alertas e Logs
â”œâ”€â”€ Painel: Alertas crÃ­ticos (Alertmanager)
â””â”€â”€ Painel: Ãšltimos logs de falha (CloudWatch Logs Insights)


---

## ğŸ“Š 2ï¸âƒ£ Exemplo de MÃ©tricas Reais (CloudWatch + Prometheus)

### ğŸ”¹ Painel AWS Glue

| MÃ©trica | DescriÃ§Ã£o | Fonte | SLI | SLO |
|----------|------------|--------|------|------|
| `aws_glue_job_run_succeeded_sum` | Total de execuÃ§Ãµes bem-sucedidas | CloudWatch Metric | % sucesso = succeeded / total | â‰¥ 99% |
| `aws_glue_job_run_failed_sum` | Total de execuÃ§Ãµes com erro | CloudWatch Metric | â€” | â€” |
| `aws_glue_job_run_duration_seconds` | DuraÃ§Ã£o mÃ©dia dos jobs ETL | CloudWatch Metric | P95 < 900s | â‰¤ 15 min |
| `custom_glue_job_queue_delay` | Tempo entre agendamento e inÃ­cio | Exporter custom | < 60s | â‰¤ 1 min |

â¡ï¸ **Consulta PromQL simulada:**

```promql
# SLI 1: Taxa de sucesso dos jobs Glue (7d)
(sum(increase(aws_glue_job_run_succeeded_sum[7d])) 
 / sum(increase(aws_glue_job_run_started_sum[7d]))) * 100

# SLI 2: DuraÃ§Ã£o mÃ©dia dos jobs Glue (15min window)
avg_over_time(aws_glue_job_run_duration_seconds[15m])
```

ğŸ”¹ Painel AWS EMR

| MÃ©trica                                     | DescriÃ§Ã£o                         | Fonte                     | SLI        | SLO              |
| ------------------------------------------- | --------------------------------- | ------------------------- | ---------- | ---------------- |
| `aws_emr_job_completed_total`               | Total de jobs Spark concluÃ­dos    | Prometheus / JMX exporter | % sucesso  | â‰¥ 99%            |
| `aws_emr_job_failed_total`                  | Total de falhas                   | Prometheus / JMX exporter | â€”          | â€”                |
| `spark_executor_cpu_time_seconds_total`     | Tempo total de CPU dos executores | Prometheus                | â€”          | UtilizaÃ§Ã£o < 80% |
| `aws_emr_cluster_provisioning_time_seconds` | Tempo de inicializaÃ§Ã£o do cluster | CloudWatch Metric         | P95 < 300s | â‰¤ 5 min          |



â¡ï¸ Consulta PromQL simulada:

```promql
# SLI 1: Sucesso dos jobs EMR
(sum(increase(aws_emr_job_completed_total[7d])) 
 / sum(increase(aws_emr_job_started_total[7d]))) * 100

# SLI 2: LatÃªncia mÃ©dia (P95)
histogram_quantile(0.95, sum(rate(aws_emr_job_duration_seconds_bucket[5m])) by (le))
```


ğŸ§® 3ï¸âƒ£ CÃ¡lculo de SLO no Grafana (exemplo em JSON/YAML)

```yaml
service: "aws-glue-etl"
indicators:
  - name: "job_success_rate"
    metric_query: |
      (sum(increase(aws_glue_job_run_succeeded_sum[30d])) 
       / sum(increase(aws_glue_job_run_started_sum[30d]))) * 100
    target: 99.0
    alert:
      warning: "< 99"
      critical: "< 98"

  - name: "job_duration_p95"
    metric_query: "histogram_quantile(0.95, sum(rate(aws_glue_job_run_duration_seconds_bucket[5m])) by (le))"
    target: 900
    alert:
      warning: "> 900"
      critical: "> 1200"
```


ğŸ§  4ï¸âƒ£ VisualizaÃ§Ã£o no Grafana (layout sugerido)

ğŸ“Š Data Lake Reliability
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸŸ¢ Glue Success Rate (SLI)
â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡  99.3%

ğŸ• Glue Job Duration (P95)
â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡  870s

ğŸ”¥ EMR Job Success Rate
â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡  99.8%

ğŸ’¸ EMR Cost Trend (R$/dia)
ğŸ’¹ line chart showing EC2 + EMR cost

âš ï¸ Recent Incidents
Glue ETL job â€œuser_data_etlâ€ failed @ 2025-10-31T08:45


ğŸš€ 5ï¸âƒ£ Consolidando SLIs e SLOs

â€œEu criaria um dashboard no Grafana consolidando SLIs e SLOs de confiabilidade do Data Lake â€” por exemplo, a taxa de sucesso dos jobs Glue e EMR, tempo mÃ©dio de execuÃ§Ã£o e latÃªncia P95.
As mÃ©tricas viriam do CloudWatch e Prometheus, e seriam correlacionadas com custo e capacidade.
Assim conseguimos identificar gargalos antes de impactar as consultas no Athena ou os consumidores de dados.â€